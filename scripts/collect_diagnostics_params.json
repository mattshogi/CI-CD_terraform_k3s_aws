{
  "commands": [
    "echo '=== date ==='",
    "date",
    "echo '=== uname -a ==='",
    "uname -a || true",
    "echo '=== cloud-init status ==='",
    "cloud-init status || true",
    "echo '=== last 200 lines cloud-init-output.log ==='",
    "tail -n 200 /var/log/cloud-init-output.log || true",
    "echo '=== k3s service status ==='",
    "systemctl status k3s --no-pager || true",
    "echo '=== ps aux | grep k3s ==='",
    "ps aux | grep -E 'k3s|containerd' || true",
    "echo '=== journalctl -u k3s --no-pager -n 200 ==='",
    "journalctl -u k3s -n 200 --no-pager || true",
    "echo '=== /var/lib/rancher/k3s/server/manifests ==='",
    "ls -1 /var/lib/rancher/k3s/server/manifests || true",
    "echo '=== kubectl get pods -A -o wide ==='",
    "/usr/local/bin/kubectl get pods -A -o wide || k3s kubectl get pods -A -o wide || true",
    "echo '=== kubectl get svc -A ==='",
    "/usr/local/bin/kubectl get svc -A || k3s kubectl get svc -A || true",
    "echo '=== kubectl get ingress -A ==='",
    "/usr/local/bin/kubectl get ingress -A || k3s kubectl get ingress -A || true",
    "echo '=== curl localhost:80 (traefik) ==='",
    "curl -s -m 5 http://127.0.0.1/ || true",
    "echo '=== netstat -tnlp | head ==='",
    "netstat -tnlp 2>/dev/null | head || ss -tnlp 2>/dev/null | head || true",
    "echo '=== iptables -t nat -L KUBE-SERVICES -n -v | head ==='",
    "iptables -t nat -L KUBE-SERVICES -n -v 2>/dev/null | head || true",
    "echo '=== iptables -t nat -L KUBE-NODEPORTS -n -v ==='",
    "iptables -t nat -L KUBE-NODEPORTS -n -v 2>/dev/null || true",
    "echo '=== /var/log/k3s_diagnostics_hello_world.txt (if exists) tail 120 ==='",
    "tail -n 120 /var/log/k3s_diagnostics_hello_world.txt || true"
  ]
}
